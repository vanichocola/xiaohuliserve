(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-draw-chat"],{"00b1":function(t,e,a){"use strict";a.r(e);var i=a("d42b"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);e["default"]=n.a},"0744":function(t,e,a){var i=a("3db4");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("36249dba",i,!0,{sourceMap:!1,shadowMode:!1})},"0920":function(t,e,a){"use strict";var i=a("64ef"),n=a.n(i);n.a},"1c53":function(t,e,a){"use strict";var i=a("0744"),n=a.n(i);n.a},"1d7e":function(t,e,a){"use strict";a.r(e);var i=a("f88b"),n=a("00b1");for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);a("1c53");var o=a("f0c5"),s=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"ae154102",null,!1,i["a"],void 0);e["default"]=s.exports},"29f9":function(t,e,a){var i=a("cf06");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("1db45e32",i,!0,{sourceMap:!1,shadowMode:!1})},"3db4":function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".image[data-v-ae154102]{width:100%;border-radius:%?20?%;border:1px solid #f6f6f6;box-sizing:border-box;float:left}.writing[data-v-ae154102]{width:%?532?%;height:%?532?%;background:#f7f7f7;display:flex;justify-content:center;align-items:center;border-radius:%?20?%}.fail[data-v-ae154102]{flex-direction:column}.fail .errmsg[data-v-ae154102]{color:#666;font-size:%?28?%;display:flex;align-items:flex-start;line-height:%?42?%;padding:%?30?% 0;overflow:hidden;max-height:%?210?%}.fail .errmsg uni-image[data-v-ae154102]{width:%?32?%;height:%?32?%;margin-right:%?10?%;position:relative;top:%?4?%}.fail .btn-retry[data-v-ae154102]{color:#666;padding:%?10?% %?24?%;background:#fff;border-radius:%?10?%;margin-top:%?20?%;font-size:%?24?%}",""]),t.exports=e},4832:function(t,e,a){"use strict";a.r(e);var i=a("f2ba"),n=a("9ef9");for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);a("0920");var o=a("f0c5"),s=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"42209366",null,!1,i["a"],void 0);e["default"]=s.exports},"54ce":function(t,e,a){"use strict";a.r(e);var i=a("7ed2"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);e["default"]=n.a},"5aa6":function(t,e,a){"use strict";var i=a("29f9"),n=a.n(i);n.a},"611a":function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("ac1f"),a("5319"),a("498a"),a("14d9"),a("c975"),a("d3b7"),a("159b"),a("e25e");var n=i(a("44fb")),r=i(a("1d7e"));a("fd1e8"),a("279a"),a("a7eb"),a("40d3");var o=getApp(),s={components:{TextComponent:n.default,ImageComponent:r.default},data:function(){return{pageIsLoad:!1,siteroot:"",lists:[],message:"",page:1,pagesize:10,scrollTop:0,inputShow:!0}},onLoad:function(t){var e=this;this.setData({system:o.globalData.system,siteroot:o.globalData.siteroot.replace("/web.php","")}),o.globalData.util.checkLogin().then((function(){e.getHistoryMsg(),e.setData({pageIsLoad:!0})}))},methods:{submitDraw:function(){var t=this,e=this.trim(this.message);if(!e){if(!this.prompt.hint)return o.globalData.util.message("请输入要求和场景描述"),void(this.message="");this.message=this.prompt.hint,e=this.message}this.message="",this.scrollToBottom(),o.globalData.util.request({url:"/draw/draw",data:{message:e}}).then((function(a){t.lists.push({state:0,draw_id:a.data.draw_id,message:e}),t.startLoopResult(a.data.draw_id),setTimeout((function(){t.scrollToBottom()}),500)})).catch((function(t){-1!==t.message.indexOf("请充值")&&o.globalData.util.message(t.message,"error",(function(){uni.navigateTo({url:"/pages/pay/draw"})}))}))},startLoopResult:function(t){var e=this,a=setInterval((function(){o.globalData.util.request({url:"/draw/getDrawResult",data:{draw_id:t},loading:!1}).then((function(i){var n=e.lists;n.forEach((function(r,o){if(r.draw_id==t){var s=i.data.state;n[o].state=s,0!=s&&(clearInterval(a),1==s?n[o].response=i.data.images:2==s&&(n[o].errmsg=i.data.message),e.lists=n,setTimeout((function(){e.scrollToBottom()}),300))}}))}))}),5e3)},retryDraw:function(t){var e=this;o.globalData.util.request({url:"/draw/draw",data:{draw_id:t}}).then((function(a){var i=e.lists;i.forEach((function(a,n){a.draw_id==t&&(i[n].state=0,i[n].errmsg="",i[n].response="",e.startLoopResult(t))})),e.lists=i}))},getHistoryMsg:function(){var t=this;o.globalData.util.request({url:"/draw/getHistoryMsg",data:{page:this.page,pagesize:this.pagesize}}).then((function(e){if(e.data.length>0){var a=e.data;t.setData({lists:a}),a.forEach((function(e,a){0==e.state&&t.startLoopResult(e.draw_id)}))}setTimeout((function(){t.scrollToBottom()}),500)}))},scrollToBottom:function(){var t=this;setTimeout((function(){var e=uni.createSelectorQuery().in(t);e.select(".list").boundingClientRect((function(e){t.setData({scrollTop:parseInt(e.height)})})),e.exec((function(t){}))}),100)},copyText:function(t){var e=document.createElement("textarea");e.value=t,e.readOnly="readOnly",e.style="width:0;height:0;",document.body.appendChild(e),e.select(),e.setSelectionRange(0,t.length),o.globalData.util.message("已复制"),document.execCommand("copy"),e.remove()},previewImage:function(t){var e=[];this.lists.forEach((function(t,a){1==t.state&&t.response.forEach((function(t,a){e.push(t)}))})),uni.previewImage({urls:e,current:t})},trim:function(t){return t?t.replace(/(^\s*)|(\s*$)/g,""):""},toEdit:function(t){this.message=t}}};e.default=s},"64ef":function(t,e,a){var i=a("aeb9");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("355feccc",i,!0,{sourceMap:!1,shadowMode:!1})},"7ed2":function(t,e,a){"use strict";a("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"loading",data:function(){return{}},props:{title:{type:String,default:""},color:{type:String,default:"#ff1d5e"}}};e.default=i},"87b9":function(t,e,a){"use strict";a.r(e);var i=a("da08"),n=a("54ce");for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);a("5aa6");var o=a("f0c5"),s=Object(o["a"])(n["default"],i["b"],i["c"],!1,null,"b40d9288",null,!1,i["a"],void 0);e["default"]=s.exports},"9ef9":function(t,e,a){"use strict";a.r(e);var i=a("611a"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);e["default"]=n.a},aeb9:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,"uni-page-body[data-v-42209366]{background:#f7f7f7}body.?%PAGE?%[data-v-42209366]{background:#f7f7f7}.box-input[data-v-42209366]{width:100%;padding:%?40?% 0;left:0;bottom:0;border-top:1px solid #d8d8e2;background:#f6fafc}.box-input .input[data-v-42209366]{width:%?690?%;margin:0 %?30?%;position:relative;box-sizing:border-box;box-shadow:0 0 %?12?% rgba(0,0,0,.1);background:#fefefe}.box-input .input uni-textarea[data-v-42209366]{width:%?580?%;padding:%?20?% %?10?% %?20?% %?20?%;border-radius:%?10?%;line-height:%?40?%}.box-input .input .btn-send[data-v-42209366]{position:absolute;right:0;bottom:0;width:%?100?%;height:%?80?%;padding:0;border:none;border-radius:%?10?%;background:none;display:flex;align-items:center;justify-content:center;z-index:9}.box-input .input .btn-send[data-v-42209366]::after{display:none}.box-input .input .btn-send[data-v-42209366]:active{background:#f2f2f2}.box-input .input .btn-send uni-image[data-v-42209366]{width:%?40?%;height:%?40?%}.page[data-v-42209366]{width:100%;overflow:hidden;display:flex;flex-direction:column;position:absolute;left:0;right:0;top:0;bottom:0;background:#f7f7f7}.box-msg-list[data-v-42209366]{width:100%;height:100%;top:0;bottom:%?132?%;left:0;box-sizing:border-box;overflow:hidden}.list[data-v-42209366]{width:100%;height:auto;padding-bottom:%?40?%;box-sizing:border-box}.message-group[data-v-42209366]{background:#fff;margin:%?40?% %?30?% 0 %?30?%;border-radius:%?20?%;overflow:hidden}.message[data-v-42209366]{display:flex;justify-content:flex-start;padding:%?40?% %?40?%}.message.user[data-v-42209366]{border-bottom:%?2?% solid #f6f6f6}.message .text[data-v-42209366]{width:100%;color:#343541;line-height:%?52?%;font-size:%?32?%;word-break:break-all;padding:%?3?% 0;overflow:hidden}.message .text span[data-v-42209366]{display:inline}.message .avatar[data-v-42209366]{width:%?48?%;height:%?48?%;background:#10a37f;margin-right:%?30?%;color:#fff;font-size:%?28?%;border-radius:%?4?%;display:flex;align-items:center;justify-content:center;margin-top:%?6?%}.message .avatar uni-image[data-v-42209366],\n.message .avatar img[data-v-42209366]{width:%?36?%;height:%?36?%}.account[data-v-42209366]{margin:%?20?% %?30?%;padding:%?16?% %?24?% %?16?% %?24?%;box-sizing:border-box;\n\t/* background: #f3f6f9; */border-radius:%?10?%;display:flex;justify-content:space-between;align-items:center}.account .balance[data-v-42209366]{color:#666;font-size:%?24?%}.account .balance uni-text[data-v-42209366]{color:#10a37f;margin-right:%?6?%}.account .btn-pay[data-v-42209366]{display:inline-block;color:#10a37f;margin-left:%?20?%;font-size:%?24?%}.banner-ad[data-v-42209366]{width:100%;height:%?120?%;border-top:%?2?% solid #ddd}.cursor[data-v-42209366]{background:#3d3d3d;width:100%;line-height:100%;border-left:.1em solid transparent;-webkit-animation:cursor-data-v-42209366 .6s infinite;animation:cursor-data-v-42209366 .6s infinite;display:inline-block;width:%?10?%;height:%?40?%;position:relative;top:%?6?%}\n\n/* Animation */@-webkit-keyframes cursor-data-v-42209366{50%{background:#fff}}@keyframes cursor-data-v-42209366{50%{background:#fff}}.content[data-v-42209366]{padding:%?20?%}.content uni-view[data-v-42209366]{margin:%?10?% 0;word-break:break-all;line-height:1.5;font-size:%?28?%;color:#444}.content img[data-v-42209366]{width:100%}.btn-copy[data-v-42209366]{color:#409eff}",""]),t.exports=e},cf06:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".loading[data-v-b40d9288]{display:flex;justify-content:center;flex-direction:column;align-items:center}.title[data-v-b40d9288]{width:100%;font-size:%?28?%;color:#999;line-height:%?28?%;margin-top:%?30?%}.fox-spinner[data-v-b40d9288], .fox-spinner *[data-v-b40d9288]{box-sizing:border-box}.fox-spinner[data-v-b40d9288]{height:60px;width:60px;overflow:hidden}.fox-spinner .spinner-inner[data-v-b40d9288]{position:relative;display:block;height:100%;width:100%}.fox-spinner .spinner-circle[data-v-b40d9288]{display:block;position:absolute;font-size:calc(60px * .24);top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.fox-spinner .spinner-line[data-v-b40d9288]{position:absolute;width:100%;height:100%;border-radius:50%;-webkit-animation-duration:1s;animation-duration:1s;border-left-width:calc(60px / 25);border-top-width:calc(60px / 25);border-left-style:solid;border-top-style:solid;border-top-color:transparent}.fox-spinner .spinner-line[data-v-b40d9288]:nth-child(1){-webkit-animation:fox-spinner-animation-1-data-v-b40d9288 1s linear infinite;animation:fox-spinner-animation-1-data-v-b40d9288 1s linear infinite;-webkit-transform:rotate(120deg) rotateX(66deg) rotate(0deg);transform:rotate(120deg) rotateX(66deg) rotate(0deg)}.fox-spinner .spinner-line[data-v-b40d9288]:nth-child(2){-webkit-animation:fox-spinner-animation-2-data-v-b40d9288 1s linear infinite;animation:fox-spinner-animation-2-data-v-b40d9288 1s linear infinite;-webkit-transform:rotate(240deg) rotateX(66deg) rotate(0deg);transform:rotate(240deg) rotateX(66deg) rotate(0deg)}.fox-spinner .spinner-line[data-v-b40d9288]:nth-child(3){-webkit-animation:fox-spinner-animation-3-data-v-b40d9288 1s linear infinite;animation:fox-spinner-animation-3-data-v-b40d9288 1s linear infinite;-webkit-transform:rotate(1turn) rotateX(66deg) rotate(0deg);transform:rotate(1turn) rotateX(66deg) rotate(0deg)}@-webkit-keyframes fox-spinner-animation-1-data-v-b40d9288{100%{-webkit-transform:rotate(120deg) rotateX(66deg) rotate(1turn);transform:rotate(120deg) rotateX(66deg) rotate(1turn)}}@keyframes fox-spinner-animation-1-data-v-b40d9288{100%{-webkit-transform:rotate(120deg) rotateX(66deg) rotate(1turn);transform:rotate(120deg) rotateX(66deg) rotate(1turn)}}@-webkit-keyframes fox-spinner-animation-2-data-v-b40d9288{100%{-webkit-transform:rotate(240deg) rotateX(66deg) rotate(1turn);transform:rotate(240deg) rotateX(66deg) rotate(1turn)}}@keyframes fox-spinner-animation-2-data-v-b40d9288{100%{-webkit-transform:rotate(240deg) rotateX(66deg) rotate(1turn);transform:rotate(240deg) rotateX(66deg) rotate(1turn)}}@-webkit-keyframes fox-spinner-animation-3-data-v-b40d9288{100%{-webkit-transform:rotate(1turn) rotateX(66deg) rotate(1turn);transform:rotate(1turn) rotateX(66deg) rotate(1turn)}}@keyframes fox-spinner-animation-3-data-v-b40d9288{100%{-webkit-transform:rotate(1turn) rotateX(66deg) rotate(1turn);transform:rotate(1turn) rotateX(66deg) rotate(1turn)}}",""]),t.exports=e},d42b:function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("87b9")),r={components:{drawLoading:n.default},props:{item:{type:Object,default:function(){return{}}}},watch:{item:{handler:function(t){console.log("val",t)},deep:!0}},created:function(){console.log("")},methods:{previewImage:function(t){this.$emit("preview",t)},retry:function(t){this.$emit("retry",t)}}};e.default=r},da08:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this.$createElement,e=this._self._c||t;return e("v-uni-view",{staticClass:"loading"},[e("v-uni-view",{staticClass:"fox-spinner"},[e("v-uni-view",{staticClass:"spinner-inner",style:"color:"+this.color},[e("v-uni-view",{staticClass:"spinner-line"}),e("v-uni-view",{staticClass:"spinner-line"}),e("v-uni-view",{staticClass:"spinner-line"}),e("v-uni-view",{staticClass:"spinner-circle"},[this._v("●")])],1)],1),this.title?e("v-uni-view",{staticClass:"title"},[this._v(this._s(this.title))]):this._e()],1)},n=[]},f2ba:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticStyle:{height:"100%"}},[t.pageIsLoad?a("v-uni-view",{staticClass:"page"},[a("v-uni-scroll-view",{staticClass:"box-msg-list",attrs:{"scroll-x":!1,"scroll-y":!0,"scroll-with-animation":!1,"scroll-top":t.scrollTop}},[t.lists&&t.lists.length>0?a("v-uni-view",{staticClass:"list"},t._l(t.lists,(function(e,i){return a("v-uni-view",{key:i,staticClass:"message-group"},[a("v-uni-view",{staticClass:"message user",attrs:{"data-index":i},on:{longpress:function(a){arguments[0]=a=t.$handleEvent(a),t.copyText(e.message)}}},[a("v-uni-view",{staticClass:"avatar",staticStyle:{background:"#9aa37e"}},[a("img",{attrs:{mode:"widthFix",src:"/static/img/ic_user.png"}})]),a("v-uni-view",{staticClass:"text"},[a("textComponent",{attrs:{text:e.message}})],1)],1),a("v-uni-view",{staticClass:"message ai"},[a("v-uni-view",{staticClass:"avatar"},[a("img",{attrs:{mode:"widthFix",src:"/static/img/ic_ai.png"}})]),a("v-uni-view",{staticClass:"text"},[a("imageComponent",{attrs:{item:e},on:{preview:function(e){arguments[0]=e=t.$handleEvent(e),t.previewImage.apply(void 0,arguments)},retry:function(e){arguments[0]=e=t.$handleEvent(e),t.retryDraw.apply(void 0,arguments)}}})],1)],1)],1)})),1):t._e()],1),a("v-uni-view",{staticClass:"box-input"},[a("v-uni-view",{staticClass:"input"},[a("v-uni-textarea",{attrs:{type:"text","auto-height":!0,placeholder:"请输入要求和场景描述",maxlength:"3000","cursor-spacing":"0"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),a("v-uni-button",{staticClass:"btn-send",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitDraw.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{mode:"widthFix",src:"/static/images/ic_send.png"}})],1)],1)],1)],1):t._e()],1)},n=[]},f88b:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[0===t.item.state?a("v-uni-view",{staticClass:"writing"},[a("draw-loading",{attrs:{title:"生成中，预计需要30秒左右",color:"#04BABE"}})],1):1===t.item.state?a("v-uni-view",t._l(t.item.response,(function(e,i){return a("v-uni-image",{staticClass:"image",attrs:{src:e,mode:"widthFix"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.previewImage(e)}}})})),1):2===t.item.state?a("v-uni-view",{staticClass:"writing fail"},[a("v-uni-view",{staticClass:"errmsg"},[a("v-uni-image",{attrs:{src:"/static/images/ic_fail.png"}}),a("v-uni-text",{staticStyle:{"max-width":"400rpx"}},[t._v("生成失败: "+t._s(t.item.errmsg))])],1),a("v-uni-view",[a("v-uni-text",{staticClass:"btn-retry",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.retry(t.item.draw_id)}}},[t._v("重新生成")])],1)],1):t._e()],1)},n=[]}}]);